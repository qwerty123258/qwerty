<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="Board"> 
	<insert id="write" parameterType="board">
	insert into board values(board_seq.nextval,#{title},#{id},#{contents},sysdate,0)
	</insert>
	
	<insert id="upload" parameterType="board">
	<selectKey resultType="string" keyProperty="currentBno" order="BEFORE">
        SELECT MAX(bno) FROM board        
    </selectKey>    
	insert into bfiles values(bfile_seq.nextval,#{bfilename},#{bfileoriname},sysdate,#{currentBno})
	</insert>
	 <select id="list" parameterType="paging" resultType="board">
 	<![CDATA[select c.bno,c.title,c.id,c.bview,to_char(writedate,'YYYY-MM-DD') as writedate from (select ROWNUM row_num,board.* from  board) c where row_num >= #{startNum} and row_num <= #{endNum}]]>
 	</select>
 	<select id="listOrder" parameterType="paging" resultType="board">
 	<![CDATA[select c.bno,c.title,c.id,c.bview,to_char(writedate,'YYYY-MM-DD') as writedate from (select ROWNUM row_num,v.* from  (select * from board order by bview desc) v) c where row_num >= #{startNum} and row_num <= #{endNum}]]>
 	</select>
 	 <select id="count" resultType="int">
 	select count(*) as count from board
 	</select>
 	 	<update id="bview" parameterType="String">
 	update board set bview=bview+1 where bno=#{bno}
 	</update>
 	 <select id="detail" parameterType="String" resultType="board">
 	select bno,title,id,bview,to_char(writedate,'YYYY-MM-DD HH:MI') as writedate,contents from board where bno=#{bno}
 	</select>
 	<delete id="delete" parameterType="String">
 	delete board where bno=#{bno}
 	</delete>
 	<update id="update" parameterType="board">
 	update board set title=#{title},contents=#{contents} where bno=#{bno}
 	</update>
 	<select id="fileList" parameterType="String" resultType="board">
 	select * from bfiles where bno=#{bno}
 	</select>
 	<delete id="allfileDelete" parameterType="board">
 	delete bfiles where bno=#{bno}
 	</delete>
 	 <insert id="allfileUpdate" parameterType="board">
 		insert into bfiles values(bfile_seq.nextval,#{bfilename},#{bfileoriname},sysdate,#{bno})
 	</insert>
 	<delete id="fileDelete" parameterType="String">
 	delete bfiles where bfilename=#{delfilename}
 	</delete>
 	<select id="searchTitleCount" parameterType="board" resultType="int">
 	select count(*) from  board WHERE title like '%'||#{keyword}||'%' 
 	</select>
 	 <select id="searchWriterCount" parameterType="board" resultType="int">
 	select count(*) from  board WHERE id like '%'||#{keyword}||'%'  
 	</select>
 	 <select id="searchTitleContentsCount" parameterType="board" resultType="int">
 	select count(*) from  board WHERE title like '%'||#{keyword}||'%' or contents like '%'||#{keyword}||'%'
 	</select>
 		 <select id="searchTitleList" parameterType="map" resultType="board">
 	<![CDATA[select c.bno,c.title,c.id,c.bview,to_char(writedate,'YYYY-MM-DD') as writedate from (select ROWNUM row_num,t.* from (select * from board where title like '%'||#{board.keyword}||'%') t ) c where row_num >= #{paging.startNum} and row_num <= #{paging.endNum}]]>
 	</select>
 		 <select id="searchWriterList" parameterType="map" resultType="board">
 	<![CDATA[select c.bno,c.title,c.id,c.bview,to_char(writedate,'YYYY-MM-DD') as writedate from (select ROWNUM row_num,t.* from  (select * from board where id like '%'||#{board.keyword}||'%') t ) c where row_num >= #{paging.startNum} and row_num <= #{paging.endNum}]]>
 	</select>
 		 <select id="searchTitleContentsList" parameterType="map" resultType="board">
 	<![CDATA[select c.bno,c.title,c.id,c.bview,to_char(writedate,'YYYY-MM-DD') as writedate from (select ROWNUM row_num,t.* from  (select * from board where title like '%'||#{board.keyword}||'%' or contents like '%'||#{board.keyword}||'%') t) c where row_num >= #{paging.startNum} and row_num <= #{paging.endNum}]]>
 	</select>
 </mapper>
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 